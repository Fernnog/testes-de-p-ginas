<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala de Intercessores</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="image/favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <header>
        <img src="image/logo.png" alt="Logotipo Escala de Intercessores" class="logo">
        <h2>GERADOR DE ESCALA DA INTERCESSÃO</h2>
    </header>
    <nav>
        <button id="nav-auth"><i class="fas fa-lock"></i> Autenticação</button>
        <button id="nav-cadastro"><i class="fas fa-user-plus"></i> Cadastro de Membros</button>
        <!-- BOTÃO NOVO (PRIORIDADE 1) -->
        <button id="nav-disponibilidade"><i class="fas fa-tasks"></i> Disponibilidade</button>
        <button id="nav-restricoes"><i class="fas fa-calendar-times"></i> Períodos de Restrição</button>
        <button id="nav-restricoes-permanentes"><i class="fas fa-ban"></i> Restrições Permanentes</button>
        <button id="nav-escala"><i class="fas fa-calendar-check"></i> Geração da Escala</button>
        <button id="btn-exportar-dados"><i class="fas fa-download"></i> Exportar Dados (JSON)</button>
        <input type="file" id="importarArquivo" accept=".json" style="display:none;">
        <button id="btn-importar-dados"><i class="fas fa-upload"></i> Importar Dados (JSON)</button>
        <button id="btn-limpar-dados"><i class="fas fa-trash"></i> Limpar Dados</button>
    </nav>

    <!-- Aba de Autenticação -->
    <div id="auth" class="tab">
        <h2>Autenticação</h2>
        <form id="formRegistro">
            <div class="input-group">
                <input type="email" id="emailRegistro" required placeholder=" ">
                <label for="emailRegistro">E-mail</label>
            </div>
            <div class="input-group">
                <input type="password" id="senhaRegistro" required placeholder=" ">
                <label for="senhaRegistro">Senha</label>
            </div>
            <button type="submit" class="secondary-button">Registrar</button>
        </form>
        <form id="formLogin">
            <div class="input-group">
                <input type="email" id="emailLogin" required placeholder=" ">
                <label for="emailLogin">E-mail</label>
            </div>
            <div class="input-group">
                <input type="password" id="senhaLogin" required placeholder=" ">
                <label for="senhaLogin">Senha</label>
            </div>
            <button type="submit" class="secondary-button">Login</button>
        </form>
        <button id="logout" style="display:none;">Logout</button>
    </div>

    <!-- Aba Cadastro de Membros -->
    <div id="cadastro" class="tab" style="display: none;">
        <h2>Cadastro de Membros</h2>
        <form id="formCadastro">
            <div class="input-group">
                <input type="text" id="nome" required placeholder=" ">
                <label for="nome">Nome</label>
            </div>
            <div class="input-group">
                <select id="genero" required>
                    <option value="" disabled selected hidden>Selecione o gênero</option>
                    <option value="M">Masculino</option>
                    <option value="F">Feminino</option>
                </select>
                <label for="genero">Gênero</label>
            </div>
            <div class="input-group">
                <input type="checkbox" id="conjugeParticipa">
                <label for="conjugeParticipa">Cônjuge participa?</label>
            </div>
            <div class="input-group" id="conjugeField" style="display: none;">
                <input type="text" id="nomeConjuge" placeholder=" ">
                <label for="nomeConjuge">Nome do cônjuge</label>
            </div>
            <button type="submit" class="secondary-button">Cadastrar</button>
        </form>
        <div class="member-list-summary" id="memberSummary">
            <p>Masculino: <span id="maleCount">0</span></p>
            <p>Feminino: <span id="femaleCount">0</span></p>
            <p>Total: <span id="totalCount">0</span></p>
        </div>
        <h3>Membros Cadastrados</h3>
        <ul id="listaMembros"></ul>
    </div>

    <!-- Aba Períodos de Restrição -->
    <div id="restricoes" class="tab" style="display: none;">
        <h2>Períodos de Restrição</h2>
        <form id="formRestricao">
            <div class="input-group">
                <select id="membroRestricao">
                    <option value="" disabled selected hidden>Selecione um membro</option>
                </select>
                <label for="membroRestricao">Membro</label>
            </div>
            <div class="input-group">
                <input type="date" id="dataInicio" required placeholder=" ">
                <label for="dataInicio">Data Início</label>
            </div>
            <div class="input-group">
                <input type="date" id="dataFim" required placeholder=" ">
                <label for="dataFim">Data Fim</label>
            </div>
            <button type="submit" class="secondary-button">Registrar</button>
        </form>
        <h3>Restrições Cadastradas</h3>
        <ul id="listaRestricoes"></ul>
    </div>

    <!-- Aba Restrições Permanentes -->
    <div id="restricoesPermanentes" class="tab" style="display: none;">
        <h2>Restrições Permanentes</h2>
        <form id="formRestricaoPermanente">
            <div class="input-group">
                <select id="membroRestricaoPermanente">
                    <option value="" disabled selected hidden>Selecione um membro</option>
                </select>
                <label for="membroRestricaoPermanente">Membro</label>
            </div>
            <div class="input-group">
                <select id="diaSemana" required>
                    <option value="" disabled selected hidden>Selecione o dia da semana</option>
                    <option value="Quarta">Quarta</option>
                    <option value="Domingo Manhã">Domingo Manhã</option>
                    <option value="Domingo Noite">Domingo Noite</option>
                    <option value="Sábado">Sábado</option>
                </select>
                <label for="diaSemana">Dia da Semana</label>
            </div>
            <button type="submit" class="secondary-button">Registrar</button>
        </form>
        <h3>Restrições Permanentes Cadastradas</h3>
        <ul id="listaRestricoesPermanentes"></ul>
    </div>

    <!-- Aba Geração da Escala -->
    <div id="escala" class="tab" style="display: none;">
        <h2>Geração da Escala</h2>
        <form id="formEscala">
            <label>Selecione a escala a gerar:</label>
            <div class="input-group">
                <input type="radio" id="escalaCultos" name="tipoEscala" value="cultos" checked>
                <label for="escalaCultos">Cultos (Quarta, Domingo Manhã e Noite)</label>
            </div>
            <div class="input-group">
                <input type="radio" id="escalaSabado" name="tipoEscala" value="sabado">
                <label for="escalaSabado">Reuniões Online (Sábado)</label>
            </div>
            <div class="input-group">
                <input type="radio" id="escalaOração" name="tipoEscala" value="oracao">
                <label for="escalaOração">Oração no WhatsApp (Diário)</label>
            </div>
            <div class="input-group">
                <select id="quantidadeCultos" required>
                    <option value="" disabled selected hidden>Selecione a quantidade</option>
                    <option value="1">1 pessoa</option>
                    <option value="2">2 pessoas</option>
                </select>
                <label for="quantidadeCultos">Quantidade por culto</label>
            </div>
            <div class="input-group">
                <select id="mesEscala" required>
                    <option value="" disabled selected hidden>Selecione o mês</option>
                    <option value="0">Janeiro</option><option value="1">Fevereiro</option><option value="2">Março</option><option value="3">Abril</option><option value="4">Maio</option><option value="5">Junho</option><option value="6">Julho</option><option value="7">Agosto</option><option value="8">Setembro</option><option value="9">Outubro</option><option value="10">Novembro</option><option value="11">Dezembro</option>
                </select>
                <label for="mesEscala">Mês</label>
            </div>
            <div class="input-group">
                <input type="number" id="anoEscala" min="2025" value="2025" required placeholder=" ">
                <label for="anoEscala">Ano</label>
            </div>
            <button type="submit" class="secondary-button">Gerar Escala</button>
        </form>
        
        <div id="escala-filtros" class="escala-filtros-container"></div>
        
        <div id="resultadoEscala" class="escala-container"></div>
        <div id="balanceIndexContainer" style="display: none; cursor: pointer;"></div>
        <div id="diagnosticReportContainer" style="display: none;"></div>
        <button id="btn-exportar-xlsx" class="secondary-button">Exportar Escala (XLSX)</button>
    </div>

    <!-- PAINEL NOVO (PRIORIDADE 1 e 3) -->
    <div id="disponibilidade" class="tab" style="display: none;">
        <h2>Visão Geral de Disponibilidade</h2>
        <p>Este painel mostra o status de cada membro para os principais turnos, desconsiderando restrições temporárias (como férias).</p>
        
        <div class="disponibilidade-filtros">
            <div class="input-group">
                <input type="text" id="filtroNomeDisponibilidade" placeholder=" ">
                <label for="filtroNomeDisponibilidade">Buscar por nome...</label>
            </div>
            <div class="filtro-botoes-grupo">
                <button data-filter="all" class="active">Todos</button>
                <button data-filter="disponivel">Apenas Disponíveis</button>
                <button data-filter="indisponivel">Apenas Indisponíveis</button>
            </div>
        </div>

        <div id="disponibilidadeContainer">
            <!-- O conteúdo será gerado dinamicamente pelo JavaScript -->
        </div>
    </div>

    <!-- Modal de Suspensão Granular -->
    <div id="suspensaoModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="modalTitle">Suspender Membro</h3>
            <input type="hidden" id="membroIndexSuspensao">
            <div class="modal-options">
                <div class="input-group"><input type="checkbox" id="suspenderCultos"><label for="suspenderCultos">Suspender de Cultos (Qua/Dom)</label></div>
                <div class="input-group"><input type="checkbox" id="suspenderSabado"><label for="suspenderSabado">Suspender de Reuniões (Sáb)</label></div>
                <div class="input-group"><input type="checkbox" id="suspenderWhatsapp"><label for="suspenderWhatsapp">Suspender de Oração (WhatsApp)</label></div>
            </div>
            <div class="modal-actions">
                <button id="btn-salvar-suspensao" class="secondary-button">Salvar Alterações</button>
                <button id="btn-cancelar-suspensao">Cancelar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Análise de Concentração -->
    <div id="analiseConcentracaoModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Análise de Concentração por Turno</h3>
                <button id="btn-fechar-analise" class="close-button">×</button>
            </div>
            <div id="analiseConcentracaoBody" class="modal-body">
                <!-- Conteúdo injetado via JS -->
            </div>
        </div>
    </div>

    <!-- Container para Notificações Toast -->
    <div id="toast-container"></div>

    <!-- Scripts do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <!-- Script principal modular -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
